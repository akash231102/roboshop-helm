apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis 
  namespace: roboshop
  # these are replicaset labels
  labels:
    project: roboshop
    component: redis
    tier: db
spec:
  replicas: 1
  selector:
  # these labels are to select pod
    matchLabels:
      project: roboshop
      component: redis
      tier: db
      # pod definition
  template:
    metadata:
      labels:
        project: roboshop
        component: redis
        tier: db
    spec:
      containers:
      - name: redis
        image: {{. Value.deployment.image}}
        imagePullPolicy: Always
        readinessProbe:
          tcpSocket: 
            port: {{ .Value.deployment.port}}
          initialDelaySeconds: 10
          periodSeconds: 10
        livenessProbe:
          tcpSocket: 
            port: {{ .Value.deployment.port}}
          initialDelaySeconds: 10
          periodSeconds: 10  
---
apiVersion: v1
kind: Service
metadata:
  name: redis
  namespace: roboshop
spec:
  selector:
    project: roboshop
    component: redis
    tier: db
  ports:
  - protocol: TCP
    port: {{ .Value.service.servicePort}}
    targetPort: 6379